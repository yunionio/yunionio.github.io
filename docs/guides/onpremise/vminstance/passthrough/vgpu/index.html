<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/onpremise/vminstance/passthrough/vgpu" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">vGPU | Cloudpods</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.cloudpods.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.cloudpods.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.cloudpods.org/docs/guides/onpremise/vminstance/passthrough/vgpu"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="vGPU | Cloudpods"><meta data-rh="true" name="description" content="vGPU是一种GPU虚拟化技术,它可以将单个物理GPU虚拟化为多个虚拟GPU实例,以供多个虚拟机同时使用。"><meta data-rh="true" property="og:description" content="vGPU是一种GPU虚拟化技术,它可以将单个物理GPU虚拟化为多个虚拟GPU实例,以供多个虚拟机同时使用。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.cloudpods.org/docs/guides/onpremise/vminstance/passthrough/vgpu"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/docs/guides/onpremise/vminstance/passthrough/vgpu" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/en/docs/guides/onpremise/vminstance/passthrough/vgpu" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/docs/guides/onpremise/vminstance/passthrough/vgpu" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Cloudpods RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Cloudpods Atom Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-999X9XX9XX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-999X9XX9XX",{anonymize_ip:!0})</script>

<script src="https://hm.baidu.com/hm.js?3c5253cd6530122d0f774cab69e3c07f" async></script>
<script src="/js/github-star.js" async></script><link rel="stylesheet" href="/assets/css/styles.a6ea42b5.css">
<script src="/assets/js/runtime~main.5b2cfc74.js" defer="defer"></script>
<script src="/assets/js/main.dd6b4f3b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cloudpods_circle_black.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/cloudpods_circle_white.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cloudpods</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/">文档</a><a class="navbar__item navbar__link" href="/blog">博客</a><a href="https://www.yunion.cn/subscription/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">服务订阅</a><a href="https://apifox.com/apidoc/shared-f917f6a6-db9f-4d6a-bbc3-ea58c945d7fd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction/">3.11</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/guides/onpremise/vminstance/passthrough/vgpu">3.11</a></li><li><a href="https://www.cloudpods.org/v3.10/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.cloudpods.org/v3.9/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.9<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/docs/guides/onpremise/vminstance/passthrough/vgpu"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/guides/onpremise/vminstance/passthrough/vgpu" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/guides/onpremise/vminstance/passthrough/vgpu" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/yunionio/cloudpods" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link GitHubLink-custom">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/introduction/">产品介绍</a><button aria-label="展开侧边栏分类 &#x27;产品介绍&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/getting-started/">快速 开始</a><button aria-label="展开侧边栏分类 &#x27;快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/guides/">用户手册</a><button aria-label="折叠侧边栏分类 &#x27;用户手册&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/climc/">命令行工具</a><button aria-label="展开侧边栏分类 &#x27;命令行工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/guides/onpremise/">私有云</a><button aria-label="折叠侧边栏分类 &#x27;私有云&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/guides/onpremise/vminstance/">虚拟机</a><button aria-label="折叠侧边栏分类 &#x27;虚拟机&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/create">新建虚拟机</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/connect">登录虚拟机</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/delete">删除虚拟机</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/purge">清除虚拟机记录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/qga">QGA 使用介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/change-disk-storge">迁移磁盘存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/migrate">虚拟机迁移</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/change-disk-driver">修改磁盘驱动</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/">设备透传</a><button aria-label="折叠侧边栏分类 &#x27;设备透传&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/gpu">GPU 透传</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/vgpu">vGPU</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/sriov">网卡SR-IOV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/custom-pci-devices">自定义PCI设备透传</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/usb-passthrough">USB 透传</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/passthrough/com-passthrough">串口COM透传</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/vminstance/perf-test/">性能测试</a><button aria-label="展开侧边栏分类 &#x27;性能测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/hugepage">使用内存大页</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/debug-server-params">调试虚拟机启动参数</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/vminstance/import/">从其他平台导入</a><button aria-label="展开侧边栏分类 &#x27;从其他平台导入&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/iothrottle">磁盘限速</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/time-clock">虚拟机时钟</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/onpremise/vminstance/daemon_server">Daemon 虚拟机</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/glance/">镜像模板</a><button aria-label="展开侧边栏分类 &#x27;镜像模板&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/host/">宿主机</a><button aria-label="展开侧边栏分类 &#x27;宿主机&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/network/">网络</a><button aria-label="展开侧边栏分类 &#x27;网络&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/baremetal/">物理机</a><button aria-label="展开侧边栏分类 &#x27;物理机&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/storage/">存储</a><button aria-label="展开侧边栏分类 &#x27;存储&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/lb/">负载均衡</a><button aria-label="展开侧边栏分类 &#x27;负载均衡&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/onpremise/scheduler/">资源调度</a><button aria-label="展开侧边栏分类 &#x27;资源调度&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/cmp/">多云管理</a><button aria-label="展开侧边栏分类 &#x27;多云管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/auth_security/">认证与权限</a><button aria-label="展开侧边栏分类 &#x27;认证与权限&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/k8s/">Kubernetes 管理</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes 管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/monitor_ops/">监控与运维</a><button aria-label="展开侧边栏分类 &#x27;监控与运维&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/guides/misc/">其他功能</a><button aria-label="展开侧边栏分类 &#x27;其他功能&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/operations/">运维手册</a><button aria-label="展开侧边栏分类 &#x27;运维手册&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/development/">开发手册</a><button aria-label="展开侧边栏分类 &#x27;开发手册&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/release-notes/">发布日志</a><button aria-label="展开侧边栏分类 &#x27;发布日志&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contact/">联系我们</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/"><span itemprop="name">用户手册</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/onpremise/"><span itemprop="name">私有云</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/onpremise/vminstance/"><span itemprop="name">虚拟机</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/onpremise/vminstance/passthrough/"><span itemprop="name">设备透传</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">vGPU</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>vGPU</h1>
<p>vGPU是一种GPU虚拟化技术,它可以将单个物理GPU虚拟化为多个虚拟GPU实例,以供多个虚拟机同时使用。</p>
<p>NVIDIA 和 AMD 都提供了虚拟 GPU（vgpu）的解决方案，但它们在实现方式上有一些不同之处。</p>
<p>NVIDIA vGPU 实现方式：</p>
<ul>
<li>NVIDIA vGPU 是基于 NVIDIA 的 GRID 技术实现的，它使用 NVIDIA 的物理 GPU 并将其划分为多个虚拟 GPU，每个虚拟 GPU 都可以被分配给一个独立的虚拟机实例。</li>
<li>NVIDIA vGPU 使用专有的虚拟 GPU 管理软件（如NVIDIA Virtual GPU Manager），该软件在物理 GPU 上创建和管理虚拟 GPU，并分配给虚拟机使用。</li>
</ul>
<p>AMD vGPU 实现方式：</p>
<ul>
<li>AMD vGPU 是基于 AMD 的 SR-IOV（Single Root I/O Virtualization）技术实现的，它通过硬件辅助虚拟化技术将物理 GPU 分割为多个虚拟 GPU。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amd-vgpu-配置">AMD vGPU 配置<a class="hash-link" aria-label="AMD vGPU 配置的直接链接" title="AMD vGPU 配置的直接链接" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#amd-vgpu-配置">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看 AMD GPU 设备PCI配置空间，确认打开 SR-IOV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lspci </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> 04:00.0 </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04:00.0 VGA compatible controller: Advanced Micro Devices, Inc. </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AMD/ATI</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Tonga XT GL </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">FirePro S7150</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog-if 00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">VGA controller</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Subsystem: Advanced Micro Devices, Inc. </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AMD/ATI</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Device 030c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Flags: bus master, fast devsel, latency </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, IRQ </span><span class="token number" style="color:#36acaa">209</span><span class="token plain">, NUMA </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Memory at 3bfe0000000 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit, prefetchable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">256M</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Memory at 3bff4000000 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit, prefetchable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">2M</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        I/O ports at </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Memory at 95c00000 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token plain">-bit, non-prefetchable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">256K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Expansion ROM at 95c40000 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">disabled</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">128K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">48</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Vendor Specific Information: </span><span class="token assign-left variable" style="color:#36acaa">Len</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">08 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">?</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Power Management version </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">58</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Express Legacy Endpoint, MSI 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> MSI: Enable+ </span><span class="token assign-left variable" style="color:#36acaa">Count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/4 Maskable+ 64bit+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Vendor Specific Information: </span><span class="token assign-left variable" style="color:#36acaa">ID</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">0001 </span><span class="token assign-left variable" style="color:#36acaa">Rev</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">Len</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">010 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">?</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Advanced Error Reporting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">270</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#19</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">2b0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Address Translation Service </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ATS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">2c0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Page Request Interface </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PRI</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">2d0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Process Address Space ID </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PASID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">328</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Alternative Routing-ID Interpretation </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ARI</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">330</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Single Root I/O Virtualization </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SR-IOV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">### 打开了 SR-IOV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Capabilities: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Vendor Specific Information: </span><span class="token assign-left variable" style="color:#36acaa">ID</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">0002 </span><span class="token assign-left variable" style="color:#36acaa">Rev</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">Len</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">070 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">?</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Kernel modules: amdgpu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>宿主机上AMD vGPU需要安装 GIM 驱动，参考： <a href="https://github.com/GPUOpen-LibrariesAndSDKs/MxGPU-Virtualization#how-to-load" target="_blank" rel="noopener noreferrer">https://github.com/GPUOpen-LibrariesAndSDKs/MxGPU-Virtualization#how-to-load</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/GPUOpen-LibrariesAndSDKs/MxGPU-Virtualization.git </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> MxGPU-Virtualization/drv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修改驱动禁用 amdgpu 驱动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/modprobe.d/blacklist.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist amdgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist amdkfd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置 VF 数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/gim_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">fb_option</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">sched_option</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">vf_num</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># vf 数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">pf_fb</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">vf_fb</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">sched_interval</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">sched_interval_us</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">fb_clear</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ modprobe gim</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改 /etc/yunion/host.conf 配置 AMD vGPU。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/yunion/host.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMDVgpuPFs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 04:00.0 </span><span class="token comment" style="color:#999988;font-style:italic"># AMD GPU PCI 地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>重启 host-agent 服务。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> onecloud rollout restart ds default-host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-vgpu-配置">NVIDIA vGPU 配置<a class="hash-link" aria-label="NVIDIA vGPU 配置的直接链接" title="NVIDIA vGPU 配置的直接链接" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#nvidia-vgpu-配置">​</a></h2>
<p>NVIDIA 需要安装 GRID 驱动(驱动在NVIDIA官网需要企业注册才能下载):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./NVIDIA-Linux-x86_64-510.85.03-vgpu-kvm.run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装好后重启服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看是否加载 nvidia vgpu 驱动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 内核需要支持 vfio 与 vfio-mdev</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lsmod </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> nvidia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia_vgpu_vfio       </span><span class="token number" style="color:#36acaa">53248</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia              </span><span class="token number" style="color:#36acaa">39120896</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">273</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mdev                   </span><span class="token number" style="color:#36acaa">24576</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> vfio_mdev,nvidia_vgpu_vfio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drm                   </span><span class="token number" style="color:#36acaa">491520</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> drm_kms_helper,drm_vram_helper,nvidia,ttm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vfio                   </span><span class="token number" style="color:#36acaa">32768</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> vfio_mdev,nvidia_vgpu_vfio,vfio_iommu_type1,vfio_pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 nvidia vgpu 管理服务状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl status nvidia-vgpu-mgr.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置 vGPU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cd /sys/class/mdev_bus/domain\:bus\:slot.function/mdev_supported_types, eg:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> /sys/class/mdev_bus/0000:82:00.0/mdev_supported_types </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia-156  nvidia-241  nvidia-284  nvidia-286  nvidia-46  nvidia-48  nvidia-50  nvidia-52  nvidia-54  nvidia-56  nvidia-58  nvidia-60  nvidia-62</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia-215  nvidia-283  nvidia-285  nvidia-287  nvidia-47  nvidia-49  nvidia-51  nvidia-53  nvidia-55  nvidia-57  nvidia-59  nvidia-61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 这些目录代表不同的 vGPU 类型，查看 nvidia-46 详细描述</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> nvidia-46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">available_instances  create               description          device_api           devices/             name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> nvidia-46/description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">num_heads</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">frl_config</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">framebuffer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1024M, </span><span class="token assign-left variable" style="color:#36acaa">max_resolution</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5120x2880, </span><span class="token assign-left variable" style="color:#36acaa">max_instance</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> nvidia-46/name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRID P40-1Q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> nvidia-46/available_instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>NVIDIA官网描述如下：</p>
<ul>
<li>available_instances
This file contains the number of instances of this vGPU type that can still be created. This file is updated any time a vGPU of this type is created on or removed from the physical GPU.</li>
<li>create
This file is used for creating a vGPU instance. A vGPU instance is created by writing the UUID of the vGPU to this file. The file is write only.</li>
<li>description
This file contains the following details of the vGPU type:
The maximum number of virtual display heads that the vGPU type supports
The frame rate limiter (FRL) configuration in frames per second
The frame buffer size in Mbytes
The maximum resolution per display head
The maximum number of vGPU instances per physical GPU
For example:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">num_heads</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">frl_config</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">framebuffer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">2048M, </span><span class="token assign-left variable" style="color:#36acaa">max_resolution</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">4096x2160, </span><span class="token assign-left variable" style="color:#36acaa">max_instance</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- device_api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> contains the string vfio_pci to indicate that a vGPU is a PCI device.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This directory contains all the mdev devices that are created </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the vGPU type. For example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ll devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Dec  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> 01:52 aa618089-8b16-4d01-a136-25a0f3c73123 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/aa618089-8b16-4d01-a136-25a0f3c73123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> contains the name of the vGPU type. For example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRID M10-2Q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以根据自己的需求配置 vGPU，eg:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 生成 uuid 格式的字符串用于配置 vGPU id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ uuidgen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">070bcb42-18fc-4971-9aa9-67f5ee1281c3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> 070bcb42-18fc-4971-9aa9-67f5ee1281c3 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> nvidia-46/create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果需要持久化的话需要配置到 /etc/rc.local 中：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo 070bcb42-18fc-4971-9aa9-67f5ee1281c3 &gt; /sys/class/mdev_bus/0000:82:00.0/mdev_supported_types/nvidia-46/create&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/rc.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置 /etc/yunion/host.conf</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nvidia_vgpu_pfs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- </span><span class="token number" style="color:#36acaa">82</span><span class="token plain">:00.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>重启 host-agent 服务</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> onecloud rollout restart ds default-host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-vgpu-虚机配置">NVIDIA vGPU 虚机配置<a class="hash-link" aria-label="NVIDIA vGPU 虚机配置的直接链接" title="NVIDIA vGPU 虚机配置的直接链接" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#nvidia-vgpu-虚机 配置">​</a></h3>
<p>虚机内安装 GIRD 驱动</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">禁用 nouveau 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /etc/modprobe.d/blacklist-nouveau.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist nouveau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options nouveau modeset=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./NVIDIA-Linux-x86_64-510.85.02-grid.run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 nvidia-gridd 服务状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl status nvidia-gridd </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置 license server 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cp /etc/nvidia/gridd.conf.template /etc/nvidia/gridd.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ vi /etc/nvidia/gridd.conf # 按需配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Description: Set License Server Address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Format:  &quot;&lt;address&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServerAddress= example.com # license server 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Description: Set License Server port number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data type: integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Format:  &lt;port&gt;, default is 7070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServerPort=7070 # license server 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Description: Set Feature to be enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data type: integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Possible values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#    0 =&gt; for unlicensed state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#    1 =&gt; for NVIDIA vGPU (Optional, autodetected as per vGPU type)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#    2 =&gt; for NVIDIA RTX Virtual Workstation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#    4 =&gt; for NVIDIA Virtual Compute Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># All other values reserved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FeatureType=1 # </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ systemctl restart nvidia-gridd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nvidia-smi -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vGPU Software Licensed Product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Product Name                      : NVIDIA RTX Virtual Workstation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        License Status                    : Licensed (Expiry: 2023-8-14 13:47:59 GMT) # license 状态为 licensed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考连接">参考连接<a class="hash-link" aria-label="参考连接的直接链接" title="参考连接的直接链接" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#参考连接">​</a></h2>
<ul>
<li><a href="https://github.com/GPUOpen-LibrariesAndSDKs/MxGPU-Virtualization#how-to-load" target="_blank" rel="noopener noreferrer">https://github.com/GPUOpen-LibrariesAndSDKs/MxGPU-Virtualization#how-to-load</a></li>
<li><a href="https://docs.nvidia.com/grid/latest/grid-vgpu-user-guide/index.html#creating-vgpu-device-red-hat-el-kvm" target="_blank" rel="noopener noreferrer">https://docs.nvidia.com/grid/latest/grid-vgpu-user-guide/index.html#creating-vgpu-device-red-hat-el-kvm</a></li>
<li><a href="https://cloud-atlas.readthedocs.io/zh_CN/latest/kvm/vgpu/vgpu_quickstart.html" target="_blank" rel="noopener noreferrer">https://cloud-atlas.readthedocs.io/zh_CN/latest/kvm/vgpu/vgpu_quickstart.html</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/yunionio/website/tree/master/docs/guides/onpremise/vminstance/passthrough/vgpu.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/onpremise/vminstance/passthrough/gpu"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">GPU 透传</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/onpremise/vminstance/passthrough/sriov"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">网卡SR-IOV</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#amd-vgpu-配置">AMD vGPU 配置</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#nvidia-vgpu-配置">NVIDIA vGPU 配置</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#nvidia-vgpu-虚机配置">NVIDIA vGPU 虚机配置</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/guides/onpremise/vminstance/passthrough/vgpu#参考连接">参考连接</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>