<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/onpremise/ha-ce" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">High Availability Installation | Cloudpods</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.cloudpods.org/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.cloudpods.org/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.cloudpods.org/en/docs/getting-started/onpremise/ha-ce"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="High Availability Installation | Cloudpods"><meta data-rh="true" name="description" content="Use ocboot deployment tool for high availability installation of Cloudpods service, which better meets the deployment needs of production environments."><meta data-rh="true" property="og:description" content="Use ocboot deployment tool for high availability installation of Cloudpods service, which better meets the deployment needs of production environments."><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.cloudpods.org/en/docs/getting-started/onpremise/ha-ce"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/docs/getting-started/onpremise/ha-ce" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/en/docs/getting-started/onpremise/ha-ce" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/docs/getting-started/onpremise/ha-ce" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Cloudpods RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Cloudpods Atom Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-999X9XX9XX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-999X9XX9XX",{anonymize_ip:!0})</script>

<script src="https://hm.baidu.com/hm.js?3c5253cd6530122d0f774cab69e3c07f" async></script>
<script src="/js/github-star.js" async></script><link rel="stylesheet" href="/en/assets/css/styles.bf8d0121.css">
<script src="/en/assets/js/runtime~main.fadb2dbb.js" defer="defer"></script>
<script src="/en/assets/js/main.905760fc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/cloudpods_circle_black.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/cloudpods_circle_white.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cloudpods</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/introduction/">Docs</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a><a href="https://www.yunion.cn/subscription/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Subscription</a><a href="https://apifox.com/apidoc/shared-f917f6a6-db9f-4d6a-bbc3-ea58c945d7fd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/introduction/">3.11</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/en/docs/getting-started/onpremise/ha-ce">3.11</a></li><li><a href="https://www.cloudpods.org/v3.10/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.cloudpods.org/v3.9/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.9<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/en/docs/getting-started/onpremise/ha-ce"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/getting-started/onpremise/ha-ce" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/getting-started/onpremise/ha-ce" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/yunionio/cloudpods" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link GitHubLink-custom">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/introduction/">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/en/docs/getting-started/">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/en/docs/getting-started/onpremise/">Private Cloud</a><button aria-label="Collapse sidebar category &#x27;Private Cloud&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/getting-started/onpremise/quickstart-virt">Quick Installation via Ocboot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/getting-started/onpremise/ha-ce">High Availability Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/getting-started/onpremise/host">Adding Compute Nodes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/getting-started/onpremise/baremetal">启用物理机管理服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/getting-started/onpremise/lbagent">部署负载均衡集群</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/en/docs/getting-started/cmp/">Multi-Cloud Management</a><button aria-label="Expand sidebar category &#x27;Multi-Cloud Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/en/docs/getting-started/baremetal/">物理机管理</a><button aria-label="Expand sidebar category &#x27;物理机管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/guides/">User Guides</a><button aria-label="Expand sidebar category &#x27;User Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/operations/">Operations</a><button aria-label="Expand sidebar category &#x27;Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/development/">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/release-notes/">Release Notes</a><button aria-label="Expand sidebar category &#x27;Release Notes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/contact/">Contact US</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/getting-started/"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/getting-started/onpremise/"><span itemprop="name">Private Cloud</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">High Availability Installation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>High Availability Installation</h1>
<p>Use <a href="https://github.com/yunionio/ocboot" target="_blank" rel="noopener noreferrer">ocboot</a> deployment tool for high availability installation of Cloudpods service, which better meets the deployment needs of production environments.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-preparation">Environment Preparation<a class="hash-link" aria-label="Direct link to Environment Preparation" title="Direct link to Environment Preparation" href="/en/docs/getting-started/onpremise/ha-ce#environment-preparation">​</a></h2>
<!-- -->
<ul>
<li>Operating System: Supported distributions vary depending on CPU architecture. The current situation of supported distributions is as follows:<!-- -->
<ul>
<li><a href="http://isoredirect.centos.org/centos/7/isos" target="_blank" rel="noopener noreferrer">CentOS 7.6~7.9 Minimal</a>: Supports x86_64 and arm64</li>
<li><a href="https://www.debian.org/distrib/" target="_blank" rel="noopener noreferrer">Debian 10/11</a>: Supports x86_64 and arm64</li>
<li><a href="https://releases.ubuntu.com/jammy/" target="_blank" rel="noopener noreferrer">Ubuntu 22.04</a>: Supports only x86_64</li>
<li><a href="https://www.kylinos.cn/scheme/server/1.html" target="_blank" rel="noopener noreferrer">Kylin V10 SP2</a>: Supports x86_64 and arm64</li>
<li><a href="https://www.chinauos.com/" target="_blank" rel="noopener noreferrer">Deepin UOS kongzi</a>: Supports x86_64 and arm64</li>
</ul>
</li>
<li>The operating system needs to be a clean version, as the deployment tool will build the specified version of Kubernetes cluster from scratch. Ensure that the system does not have container management tools such as Kubernetes and Docker installed, otherwise conflicts may occur and cause installation abnormalities.</li>
<li>Minimum system requirements: CPU 4 cores, 8GiB memory, 100GiB storage.</li>
<li>The storage paths used by virtual machines and services are both under <strong>/opt</strong> directory. Thus, it is recommended to set up a separate mount point for the <strong>/opt</strong> directory in an ideal environment.<!-- -->
<ul>
<li>For example, create a separate partition for /dev/sdb1 and format it as ext4, then mount it to the /opt directory through /etc/fstab.</li>
</ul>
</li>
</ul>
<p>Assuming that there are 3 CentOS7 machines and 1 Mariadb/MySQL machine ready, the deployment is planned as follows:</p>
<table><thead><tr><th>role</th><th>ip</th><th>interface</th><th>note</th></tr></thead><tbody><tr><td>k8s primary</td><td>10.127.90.101</td><td>eth0</td><td>the first control node</td></tr><tr><td>k8s master 1</td><td>10.127.90.102</td><td>eth0</td><td>the second control node</td></tr><tr><td>k8s master 2</td><td>10.127.90.103</td><td>eth0</td><td>the third control node</td></tr><tr><td>k8s VIP</td><td>10.127.190.10</td><td>-</td><td>the VIP used by keepalived, which will be bound to the first of the three control nodes</td></tr><tr><td>DB</td><td>10.127.190.11</td><td>-</td><td>independently deployed database node, pswd=&quot;0neC1oudDB#&quot;, port=3306</td></tr></tbody></table>
<p>The deployment of the DB is currently not managed by the ocboot deployment tool and needs to be manually deployed in advance. It is recommended to use MariaDB database and not to use MySQL 5.6 and earlier versions to prevent the &quot;Index column size too large. The maximum column size is 767 bytes.&quot; bug. The corresponding MariaDB version for each distribution is as follows:</p>
<ul>
<li>CentOS 7.6-7.9  Minimal(X86_64 and ARM64) installs MariaDB 5.5.68 by default</li>
<li>Debian 10-11 (X86_64 and ARM64) installs MariaDB 10.3.1 by default</li>
<li>Kylin V10 sp2 (X86_64 and ARM64) installs MariaDB 10.3.4 by default</li>
</ul>
<p>In addition, the deployment of a high availability database can also refer to the document: <a href="/en/docs/operations/databases/db-ha">Deploy Mariadb HA environment</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ntp-consistency-of-high-availability-cluster">NTP consistency of high availability cluster<a class="hash-link" aria-label="Direct link to NTP consistency of high availability cluster" title="Direct link to NTP consistency of high availability cluster" href="/en/docs/getting-started/onpremise/ha-ce#ntp-consistency-of-high-availability-cluster">​</a></h2>
<p>Before the installation, please ensure that the time of each node to be deployed is consistent, otherwise the certificate issuance step will fail.</p>
<p>If it is installed online, you can refer to the following command to ensure that every server in the cluster is synchronized with Internet time:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># You can choose a more convenient and accessible time server.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If the ntpdate command is not available, use the corresponding package manager on the os to install it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># For example, on CentOS: yum install -y ntp &amp;&amp; systemctl enable ntpd --now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ntpdate </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> edu.ntp.org.cn </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> hwclock </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> ntpdate </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> edu.ntp.org.cn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started-with-installation">Getting Started with Installation<a class="hash-link" aria-label="Direct link to Getting Started with Installation" title="Direct link to Getting Started with Installation" href="/en/docs/getting-started/onpremise/ha-ce#getting-started-with-installation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-ocboot">Download ocboot<a class="hash-link" aria-label="Direct link to Download ocboot" title="Direct link to Download ocboot" href="/en/docs/getting-started/onpremise/ha-ce#download-ocboot">​</a></h3>
<!-- -->
<div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Use git clone the ocboot deployment tool locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone </span><span class="token parameter variable" style="color:#36acaa">-b</span><span class="token plain"> release/3.11 https://github.com/yunionio/ocboot </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> ./ocboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-deployment-configuration">Write Deployment Configuration<a class="hash-link" aria-label="Direct link to Write Deployment Configuration" title="Direct link to Write Deployment Configuration" href="/en/docs/getting-started/onpremise/ha-ce#write-deployment-configuration">​</a></h3>
<!-- -->
<div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Setting shell environment variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DB_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;10.127.190.11&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DB_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DB_PSWD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0neC1oudDB#&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DB_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">K8S_VIP</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.127</span><span class="token plain">.190.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PRIMARY_INTERFACE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eth0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PRIMARY_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.127</span><span class="token plain">.90.101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MASTER_1_INTERFACE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eth0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MASTER_1_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.127</span><span class="token plain">.90.102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MASTER_2_INTERFACE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eth0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MASTER_2_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.127</span><span class="token plain">.90.103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate the yaml deployment configuration file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config-ha.yml </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># primary_master_node is the node that runs k8s and Cloudpods services</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">primary_master_node:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # ssh login IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  hostname: </span><span class="token string variable" style="color:#36acaa">$PRIMARY_IP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Don&#x27;t use local login</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  use_local: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # ssh login user</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  user: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # cloudpods version</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  onecloud_version: &quot;v3.11.12&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # mariadb connection address</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  db_host: &quot;</span><span class="token string variable" style="color:#36acaa">$DB_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # mariadb user</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  db_user: &quot;</span><span class="token string variable" style="color:#36acaa">$DB_USER</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # mariadb password</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  db_password: &quot;</span><span class="token string variable" style="color:#36acaa">$DB_PSWD</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # mariadb port</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  db_port: &quot;</span><span class="token string variable" style="color:#36acaa">$DB_PORT</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # The address that the node service listens to, you can specify the address of the corresponding NIC when you have multiple NICs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  node_ip: &quot;</span><span class="token string variable" style="color:#36acaa">$PRIMARY_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Default NIC Selection Rules for the Kubernetes calico Plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ip_autodetection_method: &quot;can-reach=</span><span class="token string variable" style="color:#36acaa">$PRIMARY_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # IP of the K8s control node, corresponding to the VIP on which keepalived listens</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  controlplane_host: </span><span class="token string variable" style="color:#36acaa">$K8S_VIP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # K8s control node apiserver listening port</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  controlplane_port: &quot;6443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # This node acts as a Cloudpods private cloud compute node, if you don&#x27;t want the control node to act as a compute node, you can set it to false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  as_host: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # VM can be used as Cloudpods built-in private cloud compute nodes (default is false). When turning this on, make sure as_host: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  as_host_on_vm: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Product version, select one from [Edge, CMP, FullStack]. FullStack will install Converged Cloud, CMP will install Multi-Cloud Management Edition, Edge will install Private Cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  product_version: &#x27;Edge&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # If the machine to be deployed is not in mainland China, you can use dockerhub&#x27;s mirror repository: docker.io/yunion</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  image_repository: registry.cn-beijing.aliyuncs.com/yunion</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Enabling High Availability Mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  high_availability: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Using minio as the VM image backend store</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  enable_minio: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ha_using_local_registry: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # NIC corresponding to default bridge br0 on compute node</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  host_networks: &quot;</span><span class="token string variable" style="color:#36acaa">$PRIMARY_INTERFACE</span><span class="token string" style="color:#e3116c">/br0/</span><span class="token string variable" style="color:#36acaa">$PRIMARY_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">master_nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # The K8s vip of the control node to join</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  controlplane_host: </span><span class="token string variable" style="color:#36acaa">$K8S_VIP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # The K8s apiserver port of the control node to join</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  controlplane_port: &quot;6443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # As a K8s and Cloudpods control node</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  as_controller: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # This node acts as a Cloudpods private cloud compute node, if you don&#x27;t want the control node to act as a compute node, you can set it to false</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  as_host: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # VM can be used as Cloudpods built-in private cloud compute nodes (default is false). When turning this on, make sure as_host: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  as_host_on_vm: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Synchronizing ntp time from the primary node</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ntpd_server: &quot;</span><span class="token string variable" style="color:#36acaa">$PRIMARY_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Enabling High Availability Mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  high_availability: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - user: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    hostname: &quot;</span><span class="token string variable" style="color:#36acaa">$MASTER_1_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    # NIC corresponding to default bridge br0 on compute node</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    host_networks: &quot;</span><span class="token string variable" style="color:#36acaa">$MASTER_1_INTERFACE</span><span class="token string" style="color:#e3116c">/br0/</span><span class="token string variable" style="color:#36acaa">$MASTER_1_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - user: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    hostname: &quot;</span><span class="token string variable" style="color:#36acaa">$MASTER_2_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    # NIC corresponding to default bridge br0 on compute node</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    host_networks: &quot;</span><span class="token string variable" style="color:#36acaa">$MASTER_2_INTERFACE</span><span class="token string" style="color:#e3116c">/br0/</span><span class="token string variable" style="color:#36acaa">$MASTER_2_IP</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-deployment">Start Deployment<a class="hash-link" aria-label="Direct link to Start Deployment" title="Direct link to Start Deployment" href="/en/docs/getting-started/onpremise/ha-ce#start-deployment">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./ocboot.py </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ./config-k8s-ha.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After the deployment completes, you can use a web browser to access <a href="https://10.127.190.10" target="_blank" rel="noopener noreferrer">https://10.127.190.10</a> (VIP), enter the username <code>admin</code> and password <code>admin@123</code>, then access the frontend.</p>
<p>Additionally, after deployment is complete, you can add nodes to an existing cluster. Refer to the document: <a href="/en/docs/getting-started/onpremise/host">Add Compute Nodes</a>. Note that when adding nodes, the ip of the control node cannot use vip. Only use the actual ip of the first control node, because vip may have drifted to other nodes. Usually, only the first node is configured with ssh to login to other nodes without password. Using other control nodes will cause ssh login to fail.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequently-asked-questions">Frequently Asked Questions<a class="hash-link" aria-label="Direct link to Frequently Asked Questions" title="Direct link to Frequently Asked Questions" href="/en/docs/getting-started/onpremise/ha-ce#frequently-asked-questions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-how-to-manually-re-add-the-control-node">1. How to manually re-add the control node?<a class="hash-link" aria-label="Direct link to 1. How to manually re-add the control node?" title="Direct link to 1. How to manually re-add the control node?" href="/en/docs/getting-started/onpremise/ha-ce#1-how-to-manually-re-add-the-control-node">​</a></h3>
<!-- -->
<p>All 3 control nodes will run critical services such as kube-apiserver and etcd. If one of the nodes encounters an etcd data inconsistency, the node can be reset and re-added to the cluster according to the following steps:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># create join token on another normal control node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/kubernetes/admin.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ocadm token create </span><span class="token parameter variable" style="color:#36acaa">--description</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ocadm-playbook-node-joining-token&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--ttl</span><span class="token plain"> 90m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2fmpbx.7zikd8sp5uhaxrjr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get control node authentication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /opt/yunion/bin/ocadm init phase upload-certs </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> upload-certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6150f8da2dcdf3a8a730f407ddce9f1cb9f24b15ffa4e4b3680e16ed40201cf0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##########  Note that the following commands need to be executed on the node that needs to be added/reset  ###########</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># if the node has been added to the cloud platform as a compute node before</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># it is necessary to back up the current /etc/yunion/host.conf file </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">your-reset-node</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> $ </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /etc/yunion/host.conf /etc/yunion/host.conf.manual.bk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># log in to the node that needs to be reset and reset the current kubernetes environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">your-reset-node</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> $ kubeadm reset </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Assuming the current network card is bond0 (if not bonded, the physical network card is generally named eth0 or similar), the IP is 172.16.84.40, and needs to join the cluster 172.16.84.101:6443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">your-reset-node</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> $ ocadm </span><span class="token function" style="color:#d73a49">join</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --control-plane </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.84.101:6443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># target cluster to be joined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token parameter variable" style="color:#36acaa">--token</span><span class="token plain"> 2fmpbx.7zikd8sp5uhaxrjr --certificate-key 6150f8da2dcdf3a8a730f407ddce9f1cb9f24b15ffa4e4b3680e16ed40201cf0 --discovery-token-unsafe-skip-ca-verification </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># join authentication information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --apiserver-advertise-address </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.84.40 --node-ip </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.84.40 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># IP address of the node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --as-onecloud-controller </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># as a cloudpods control node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --enable-host-agent </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># as a cloudpods compute node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --host-networks </span><span class="token string" style="color:#e3116c">&#x27;bond0/br0/172.16.84.40&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># bridge network of the compute node, which means creating the br0 bridge, adding bond0 to it and configuring the IP of 172.16.84.40 to br0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --high-availability-vip </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.84.101 --keepalived-version-tag v2.0.25 </span><span class="token comment" style="color:#999988;font-style:italic"># keepalived&#x27;s VIP, ensuring the high availability of kube-apiserver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># After joining is complete, restore the /etc/yunion/host.conf.manual.bk configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">your-reset-node</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> $ </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /etc/yunion/host.conf.manual.bk /etc/yunion/host.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># restart the host service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> onecloud </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> wide </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$your</span><span class="token plain">-reset-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete pods </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> onecloud default-host-xxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above manual steps reference the logic of ocboot join master-node and can be found at <a href="https://github.com/yunionio/ocboot/blob/master/onecloud/roles/master-node/tasks/main.yml" target="_blank" rel="noopener noreferrer">https://github.com/yunionio/ocboot/blob/master/onecloud/roles/master-node/tasks/main.yml</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/yunionio/website/tree/master/docs/getting-started/onpremise/ha-ce.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/getting-started/onpremise/quickstart-virt"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Quick Installation via Ocboot</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/getting-started/onpremise/host"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Adding Compute Nodes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#environment-preparation">Environment Preparation</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#ntp-consistency-of-high-availability-cluster">NTP consistency of high availability cluster</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#getting-started-with-installation">Getting Started with Installation</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#download-ocboot">Download ocboot</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#write-deployment-configuration">Write Deployment Configuration</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#start-deployment">Start Deployment</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#frequently-asked-questions">Frequently Asked Questions</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/docs/getting-started/onpremise/ha-ce#1-how-to-manually-re-add-the-control-node">1. How to manually re-add the control node?</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>