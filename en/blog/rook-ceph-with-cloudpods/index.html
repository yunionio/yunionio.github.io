<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云 | Cloudpods</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.cloudpods.org/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.cloudpods.org/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云 | Cloudpods"><meta data-rh="true" name="description" content="背景介绍"><meta data-rh="true" property="og:description" content="背景介绍"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-10-09T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/zexi,https://github.com/swordqiu"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/blog/rook-ceph-with-cloudpods" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.cloudpods.org/blog/rook-ceph-with-cloudpods" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods","mainEntityOfPage":"https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods","url":"https://www.cloudpods.org/en/blog/rook-ceph-with-cloudpods","headline":"Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云","name":"Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云","description":"背景介绍","datePublished":"2021-10-09T00:00:00.000Z","author":[{"@type":"Person","name":"Zexi Li","url":"https://github.com/zexi","image":"https://github.com/zexi.png"},{"@type":"Person","name":"Jian Qiu","description":"Cloudpods maintainer","url":"https://github.com/swordqiu","image":"https://github.com/swordqiu.png"}],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.cloudpods.org/en/blog","name":"Cloudpods blog"}}</script><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Cloudpods RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Cloudpods Atom Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-999X9XX9XX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-999X9XX9XX",{anonymize_ip:!0})</script>

<script src="https://hm.baidu.com/hm.js?3c5253cd6530122d0f774cab69e3c07f" async></script>
<script src="/js/github-star.js" async></script><link rel="stylesheet" href="/en/assets/css/styles.bf8d0121.css">
<script src="/en/assets/js/runtime~main.c8aa0ee0.js" defer="defer"></script>
<script src="/en/assets/js/main.684ddf92.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/cloudpods_circle_black.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/cloudpods_circle_white.svg" alt="Cloudpods Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cloudpods</b></a><a class="navbar__item navbar__link" href="/en/docs/introduction/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/blog">Blog</a><a href="https://www.yunion.cn/subscription/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Subscription</a><a href="https://apifox.com/apidoc/shared-f917f6a6-db9f-4d6a-bbc3-ea58c945d7fd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/introduction/">3.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/introduction/">3.11</a></li><li><a href="https://www.cloudpods.org/v3.10/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.cloudpods.org/v3.9/" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.9<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/en/blog/rook-ceph-with-cloudpods"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/rook-ceph-with-cloudpods" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/blog/rook-ceph-with-cloudpods" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/yunionio/cloudpods" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link GitHubLink-custom">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/refactoring-bash-scripts-to-comply-with-the-google-coding-style">记一次符合 Google Coding Style 的 Bash 脚本重构</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/introduction-to-the-skypilot-open-source-project">SkyPilot：构建在多云之上的 ML 和数据科学，可节约 3 倍以上成本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cloudpods-k8s-experience-sharing">Cloudpods容器化经验分享</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cloudpods-golang">Cloudpods Golang实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/skycomputing">天空 计算——云计算的下一个时代?</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/en/blog/rook-ceph-with-cloudpods">Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/calico-customized-node-firewall">用Calico网络策略设置主机node防火墙规则</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/ocfs2-as-san-filesystem">QEMU+OCFS2: 使用OCFS2作为虚拟机磁盘文件的SAN存储文件系统</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/keystone-slow-password-auth">问题分析：为什么keystone的本地用户认证接口压测性能很差？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cgroups-kubernetes-pid-limits">使用 Cgroups 限制 Kubernetes Pod 进程数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nvidia-gpu-passthrough-record">使用Linux vfio将Nvidia GPU透传给QEMU虚拟机</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cloudpods-3.7-new-feature-introduction">Cloudpods 3.7版本新功能介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cloudpods-lb-application-intro">Cloudpods负载均衡的功能介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/unified-iaas-for-future">面向未来的 IT 基础设施管理架构——融合云（Unified IaaS）</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Cloudpods + Rook + Ceph 轻松实现云原生的超融合私有云</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-10-09T00:00:00.000Z">October 9, 2021</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zexi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zexi.png" alt="Zexi Li"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/zexi" target="_blank" rel="noopener noreferrer"><span>Zexi Li</span></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/swordqiu" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/swordqiu.png" alt="Jian Qiu"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/swordqiu" target="_blank" rel="noopener noreferrer"><span>Jian Qiu</span></a></div><small class="avatar__subtitle">Cloudpods maintainer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="背景介绍">背景介绍<a class="hash-link" aria-label="Direct link to 背景介绍" title="Direct link to 背景介绍" href="/en/blog/rook-ceph-with-cloudpods#背景介绍">​</a></h2>
<ul>
<li><a href="https://www.cloudpods.org" target="_blank" rel="noopener noreferrer">Cloudpods</a>: 是我们开源的多云管理平台，运行在 Kubernetes 之上，里面包含一个完整的私有云实现。</li>
<li><a href="https://rook.io/docs/rook/v1.7" target="_blank" rel="noopener noreferrer">Rook</a>: 是一个分布式存储编排系统，目的是在 Kubernetes 上提供存储解决方案，本身不提供存储，而是在 Kubernetes 和存储系统之间提供适配层，简化存储系统的部署和维护工作。其支持的 Ceph 存储为 Stable 生产可用的状态。</li>
<li><a href="https://docs.ceph.com/" target="_blank" rel="noopener noreferrer">Ceph</a>: 是开源的分布式存储系统，主要功能包含 RBD 块存储以及 CephFS 分布式文件系统存储。</li>
</ul>
<p>Cloudpods 服务以  容器化的方式运行在 Kubernetes 集群之上，按照 <a href="/en/docs/getting-started/">安装部署</a> 文档部署完 Cloudpods 之后，环境就有了一个完整的 Kubernetes 集群。</p>
<p>但 Cloudpods 内置私有云虚拟机使用的是本地存储，本文主要介绍使用 Rook 在 Cloudpods Kubernetes 集群里面的计算节点上部署 Ceph 集群，然后把 Rook 管理的 Ceph 集群暴露出来对接 Cloudpods 的私有云虚拟机。</p>
<p>Cloudpods 内置私有云提供虚拟化功能， Rook 管理的 Ceph 提供分布式存储，并且这些服务都是容器化，基于 Kubernetes 运行的。Cloudpods 运行虚拟机的节点也叫计算节点，计算节点也是 Kubernetes 的 Node，只要计算节点上有独立的裸盘，就可以使用 Rook 把 Ceph 部署到计算节点上，把这些技术结合起来可以轻松实现一个云原生的超融合私有云。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境准备">环境准备<a class="hash-link" aria-label="Direct link to 环境准备" title="Direct link to 环境准备" href="/en/blog/rook-ceph-with-cloudpods#环境准备">​</a></h2>
<ul>
<li>Cloudpods：v3.6 以上的多节点部署版本<!-- -->
<ul>
<li>3 台计算节点，有单独的裸盘给 Ceph 使用(同时作为存储节点使用)</li>
</ul>
</li>
<li>Kubernetes：v1.15.9 版本(Cloudpods 默认的集群)</li>
<li>Rook: v1.7 版本</li>
<li>操作系统：CentOS 7</li>
<li>内核版本：3.10.0-1062.4.3.el7.yn20191203.x86_64<!-- -->
<ul>
<li>如果使用 CephFS 建议的内核版本是 4.17 以上的版本，可以升级我们官方提供的 5.4 版本内核</li>
</ul>
</li>
</ul>
<p>其中 Ceph 相关的环境准备工作和限制可以参考 Rook 提供的文档：<a href="https://rook.io/docs/rook/v1.7/pre-reqs.html" target="_blank" rel="noopener noreferrer">https://rook.io/docs/rook/v1.7/pre-reqs.html</a> 。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-rook-部署-ceph">使用 Rook 部署 Ceph<a class="hash-link" aria-label="Direct link to 使用 Rook 部署 Ceph" title="Direct link to 使用 Rook 部署 Ceph" href="/en/blog/rook-ceph-with-cloudpods#使用-rook-部署-ceph">​</a></h2>
<p>接下来介绍使用 Rook 在已有的 Cloudpods Kubernetes 集群上部署 Ceph 集群，这里有个前提是已经按照 <a href="/en/docs/getting-started/onpremise/host">安装部署/添加节点</a> 文档，部署了一个多节点的 Cloudpods 集群。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="节点信息">节点信息<a class="hash-link" aria-label="Direct link to 节点信息" title="Direct link to 节点信息" href="/en/blog/rook-ceph-with-cloudpods#节点信息">​</a></h3>
<p>假设已有的 3 个节点为 node-{0,1,2}，每个节点的磁盘信息如下，sd{b,c,d} 都是没有分区的裸盘，留给 Ceph 使用：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lsblk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sda      </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:0    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">931</span><span class="token plain">.5G  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─sda1   </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:1    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     1M  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> part</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─sda2   </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:2    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   512M  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> part /boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─sda3   </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:3    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   931G  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> part /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdb      </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:16   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">931</span><span class="token plain">.5G  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdc      </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:32   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.7T  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdd      </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.7T  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> disk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>kubectl get nodes</code> 可以看到已经在 Kubernetes 集群中的节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      STATUS   ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudbox  Ready    master   34d   v1.15.9-beta.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-0    Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   12d   v1.15.9-beta.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-1    Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   11d   v1.15.9-beta.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-2    Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   11d   v1.15.9-beta.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后给对应的节点打上 role=storage-node 的标签：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 打标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl label </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> node-0 </span><span class="token assign-left variable" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl label </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> node-1 </span><span class="token assign-left variable" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl label </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> node-2 </span><span class="token assign-left variable" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看标签对应的节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get nodes </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME       STATUS   ROLES    AGE   VERSION          ROLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudbox   Ready    master   34d   v1.15.9-beta.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-0     Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   12d   v1.15.9-beta.0   storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-1     Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   11d   v1.15.9-beta.0   storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node-2     Ready    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   11d   v1.15.9-beta.0   storage-node</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>另外执行 <code>climc host-list</code> 命令(climc 是云平台的命令行工具)，也可以看到这 3 个节点作为 Cloudpods 的计算节点加入到了云平台:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ climc host-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+----------+-------------------+----------------+--------------+-----------------------------+---------+---------+-------------+----------+-----------+------------+------------+--------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                  ID                  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   Name   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">    Access_mac     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   Access_ip    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   Ipmi_Ip    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         Manager_URI         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Status  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> enabled </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> host_status </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> mem_size </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cpu_count </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> node_count </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     sn     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> storage_type </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> host_type  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+----------+-------------------+----------------+--------------+-----------------------------+---------+---------+-------------+----------+-----------+------------+------------+--------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 0d8023ad-ebf9-4a3c-8294-fd170f4ce5c6 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> node-0   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">38</span><span class="token plain">:ea:a7:8d:94:78 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.127 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.2 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> https://172.16.254.127:8885 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> running </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> online      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128695</span><span class="token plain">   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 6CU3505M2G </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> rotate       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> hypervisor </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> c02470b3-9666-46f7-852e-9bda8074a72e </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> node-1   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ec:f4:bb:d7:c4:e0 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.124 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.5 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> https://172.16.254.124:8885 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> running </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> online      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96432</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 62CNF52    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> rotate       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> hypervisor </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 5811c2d9-2b45-47e4-8c08-a5d479d03009 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> node-2   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> d4:ae:52:7e:90:9c </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.126 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.3 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> https://172.16.254.126:8885 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> running </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> online      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128723</span><span class="token plain">   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 8Q1PB3X    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> rotate       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> hypervisor </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+----------+-------------------+----------------+--------------+-----------------------------+---------+---------+-------------+----------+-----------+------------+------------+--------------+------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署-rook-组件">部署 Rook 组件<a class="hash-link" aria-label="Direct link to 部署 Rook 组件" title="Direct link to 部署 Rook 组件" href="/en/blog/rook-ceph-with-cloudpods#部署-rook-组件">​</a></h3>
<p>下载 Rook 相关代码：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># clone rook 源码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone --single-branch </span><span class="token parameter variable" style="color:#36acaa">--branch</span><span class="token plain"> release-1.7 https://github.com/rook/rook.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> rook</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>部署 rook operator 服务：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># apply rook 相关 CRD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> cluster/examples/kubernetes/ceph/pre-k8s-1.16/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> crds.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># apply rook operator 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> common.yaml </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> operator.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 operator 服务的状态，等待 rook-ceph-operator pod 变为 Running</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rook-ceph get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-operator-68964f4b87-pc87m   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          7m38s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建-ceph-集群">创建 ceph 集群<a class="hash-link" aria-label="Direct link to 创建 ceph 集群" title="Direct link to 创建 ceph 集群" href="/en/blog/rook-ceph-with-cloudpods#创建-ceph-集群">​</a></h3>
<p>首先根据自己的环境，修改 rook 提供的 <code>cluster.yaml</code> 里面的内容：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> cluster.yaml cluster-env.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面是修改后的 cluster.yaml 和 cluster-env.yaml 的 diff 内容：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> cluster.yaml cluster-env.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>请根据自己的节点环境配置，参考 diff 修改，需要注意的地方如下：</p>
<ul>
<li>spec.image: 改为 registry.cn-beijing.aliyuncs.com/yunionio/ceph<!-- -->:v14<!-- -->.2.22 ，这里需要用 v14 版本的镜像，对应的 ceph 版本为 nautilus。如果要使用更高版本 v16 版本ceph，请参考下文 [使用 Pacific (v16) Ceph]。</li>
<li>spec.network.provider: 改为 host ，表示 ceph 相关容器使用 hostNetwork ，这样才能给 Kubernetes 集群之外的服务使用</li>
<li>spec.placement: 修改了里面的 Kubernetes 调度策略，表示把 ceph pod 调度到 role=storage-node 的节点上</li>
<li>spec.storage: 表示存储的配置<!-- -->
<ul>
<li>useAllNodes: 我们指定了role=storage-node 的节点运行 ceph，该值必须设置为false</li>
<li>nodes: 分别设置各个节点的存储路径，可以是磁盘或者目录</li>
</ul>
</li>
</ul>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token coord">--- cluster.yaml    2021-10-09 10:49:53.731596210 +0800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token coord">+++ cluster-env.yaml    2021-10-09 17:50:01.859112585 +0800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token coord">@@ -21,7 +21,7 @@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # versions running within the cluster. See tags available at https://hub.docker.com/r/ceph/ceph/tags/.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # If you want to be more precise, you can always use a timestamp tag such quay.io/ceph/ceph:v16.2.6-20210918</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # This tag might not contain a new Ceph version, just security fixes from the underlying operating system, which will reduce vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    image: quay.io/ceph/ceph:v16.2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    image: registry.cn-beijing.aliyuncs.com/yunionio/ceph:v14.2.22</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # Whether to allow unsupported versions of Ceph. Currently `nautilus`, `octopus`, and `pacific` are supported.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # Future versions such as `pacific` would require this to be set to `true`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # Do not set to true in production.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token coord">@@ -81,7 +81,7 @@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    rulesNamespace: rook-ceph</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  network:</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # enable host networking</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #provider: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    provider: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # enable the Multus network provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    #provider: multus</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    #selectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token coord">@@ -135,22 +135,22 @@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # To control where various services will be scheduled by kubernetes, use the placement configuration sections below.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # The example under &#x27;all&#x27; would have all services scheduled on kubernetes nodes labeled with &#x27;role=storage-node&#x27; and</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # tolerate taints with a key of &#x27;storage-node&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#  placement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#    all:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      nodeAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#        requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#          nodeSelectorTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#          - matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#            - key: role</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#              operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#              values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#              - storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      podAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      topologySpreadConstraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#      - key: storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">#        operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">  placement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    all:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      nodeAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">        requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          nodeSelectorTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">            - key: role</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">              operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">              values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">              - storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      podAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      topologySpreadConstraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      - key: storage-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">        operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># The above placement information can also be specified for mon, osd, and mgr components</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">#    mon:</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># Monitor deployments may contain an anti-affinity rule for avoiding monitor</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token coord">@@ -207,8 +207,8 @@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">#    osd: rook-ceph-osd-priority-class</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">#    mgr: rook-ceph-mgr-priority-class</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  storage: # cluster level storage configuration and selection</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    useAllNodes: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    useAllDevices: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    useAllNodes: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    useAllDevices: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    #deviceFilter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">      # crushRoot: &quot;custom-root&quot; # specify a non-default root label for the CRUSH map</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token coord">@@ -219,17 +219,22 @@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">      # encryptedDevice: &quot;true&quot; # the default value for this option is &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># Individual nodes and their config can be specified as well, but &#x27;useAllNodes&#x27; above must be set to false. Then, only the named</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># nodes below will be used as storage resources.  Each node&#x27;s &#x27;name&#x27; field should match their &#x27;kubernetes.io/hostname&#x27; label.</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    # nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #   - name: &quot;172.17.4.201&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #     devices: # specific devices to use for storage can be specified for each node</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #       - name: &quot;sdb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #       - name: &quot;nvme01&quot; # multiple osds can be created on high performance devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #         config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #           osdsPerDevice: &quot;5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #       - name: &quot;/dev/disk/by-id/ata-ST4000DM004-XXXX&quot; # devices can be specified using full udev paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #     config: # configuration can be specified at the node level which overrides the cluster level config</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #   - name: &quot;172.17.4.301&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token deleted-sign deleted prefix deleted" style="color:#d73a49">-</span><span class="token deleted-sign deleted line" style="color:#d73a49">    #     deviceFilter: &quot;^sd.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token deleted-sign deleted line" style="color:#d73a49"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">    nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      - name: &quot;node-0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">        devices: # specific devices to use for storage can be specified for each node</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      - name: &quot;node-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">        devices:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">      - name: &quot;node-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">        devices:</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token inserted-sign inserted prefix inserted" style="color:#36acaa">+</span><span class="token inserted-sign inserted line" style="color:#36acaa">          - name: &quot;sdd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token inserted-sign inserted line" style="color:#36acaa"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    # when onlyApplyOSDPlacement is false, will merge both placement.All() and placement.osd</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    onlyApplyOSDPlacement: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  # The section for configuring management of daemon disruptions during upgrade or fencing.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编辑好 <code>cluster-env.yaml</code> 后，使用下面的命令创建 ceph 集群：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> cluster-env.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cephcluster.ceph.rook.io/rook-ceph created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 rook-ceph namespace 里面的 pod 健康状况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rook-ceph get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                 READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-crashcollector-dl380p-55f6cc56c9-b8ghc     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-crashcollector-r710-7d8659858-mrqgq        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-crashcollector-r720xd-1-5b686487c5-hvzdb   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-csi-detect-version-ffdsf                   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          26m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-mgr-a-759465b6c7-cslkp                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m13s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-mon-a-657c4c6769-ljtr9                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          18m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-mon-b-7db98b99d4-99pft                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          18m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-mon-c-7f84fc475d-5v599                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          10m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-operator-68964f4b87-pc87m                  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          68m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-0-7cc5cb94cb-dxznm                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m32s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-1-f4d47ddf9-7vgh7                      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m35s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-2-5d7667b8d8-d5tnp                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-3-c9c56cd77-8sbzj                      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m32s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-4-88565589c-rnpmg                      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m35s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-5-7d7c554b6c-pvsfx                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m35s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-6-6c7596c844-jg9qt                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-7-55f9987ddf-pjthz                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m32s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-8-6949b69dd6-685wp                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m20s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-prepare-dl380p-c6nc8                   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-prepare-r710-zkmjz                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-osd-prepare-r720xd-1-fswnf                 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 ceph 集群的健康状况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rook-ceph get cephcluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        DATADIRHOSTPATH   MONCOUNT   AGE   PHASE   MESSAGE                        HEALTH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph   /var/lib/rook     </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">          29m   Ready   Cluster created successfully   HEALTH_OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ceph 集群部署完后，我们需要部署 <code>toolbox.yaml</code> pod 获取集群连接信息：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> toolbox.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/rook-ceph-tools created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rook-ceph get pods </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rook-ceph-tools-885579f55-qpnhh                      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m44s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 进入 toolbox pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rook-ceph </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> rook-ceph get pod </span><span class="token variable parameter variable" style="color:#36acaa">-l</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;app=rook-ceph-tools&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{.items[0].metadata.name}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 mon_host 为: 172.16.254.126:6789,172.16.254.124:6789,172.16.254.127:6789</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/ceph/ceph.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">global</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mon_host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.126:6789,172.16.254.124:6789,172.16.254.127:6789</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client.admin</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyring </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /etc/ceph/keyring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 keyring 为: AQBHTWFhFQzrORAALLIngo/OOTDdnUf4vNPRoA==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/ceph/keyring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client.admin</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AQBHTWFhFQzrORAALLIngo/OOTDdnUf4vNPRoA</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看集群健康状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ceph status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id:     233cf123-7a1a-4a7b-b6db-1cee79ec752b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health: HEALTH_OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mon: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> daemons, quorum a,b,c </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">age 38m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mgr: a</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">active, since 33m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    osd: </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> osds: </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> up </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">since 33m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">since 34m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> remapped pgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pools:   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> pools, </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"> pgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    objects: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> objects, </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage:   </span><span class="token number" style="color:#36acaa">57</span><span class="token plain"> MiB used, </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> TiB / </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> TiB avail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pgs:     </span><span class="token number" style="color:#36acaa">226</span><span class="token plain"> active+clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token number" style="color:#36acaa">30</span><span class="token plain">  active+clean+remapped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 osd 状态，可以发现对应节点的设备都添加了进来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ceph osd status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID  HOST    USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  node-0  6172k  3725G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  node-1  7836k   279G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  node-2  5596k   931G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  node-0  6044k  3725G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  node-1  5980k   279G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">  node-1  5980k   279G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">  node-2  6236k  3726G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">  node-0  7772k  3725G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">  node-2  7836k  3726G      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   exists,up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建一个 cloudpods-test 的 pool 用于后面的虚拟机测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ceph osd pool create cloudpods-test </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pool </span><span class="token string" style="color:#e3116c">&#x27;cloudpods-test&#x27;</span><span class="token plain"> created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化这个pool 为 RBD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ rbd pool init cloudpods-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@rook-ceph-tools-885579f55-qpnhh /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ceph osd lspools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> cloudpods-test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cloudpods-虚拟机使用-rook-部署的-ceph">Cloudpods 虚拟机使用 Rook 部署的 Ceph<a class="hash-link" aria-label="Direct link to Cloudpods 虚拟机使用 Rook 部署的 Ceph" title="Direct link to Cloudpods 虚拟机使用 Rook 部署的 Ceph" href="/en/blog/rook-ceph-with-cloudpods#cloudpods-虚拟机使用-rook-部署的-ceph">​</a></h2>
<p>通过之前的步骤，已经使用 Rook 在 Kubernetes 集群里面部署了 Ceph 集群，接下来将 Ceph 集群的连接信息导入到 Cloudpods 私有云平台，就可以给虚拟机使用了。</p>
<p>从之前的步骤得到 ceph 的连接信息如下：</p>
<ul>
<li>mon_host: 172.16.254.126:6789,172.16.254.124:6789,172.16.254.127:6789</li>
<li>keyring: AQBHTWFhFQzrORAALLIngo/OOTDdnUf4vNPRoA==</li>
<li>rbd pool: cloudpods-test</li>
</ul>
<p>然后登录 cloudpods 前端创建 ceph rbd 存储并且关联宿主机，操作如下：</p>
<ol>
<li>创建名为 rook-ceph 的块存储，填入上面的信息：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/en/assets/images/create-ceph-storage-ddc0f4174ac0860d59194f45f89a7397.png" width="1990" height="1223" class="img_ev3q"></p>
<ol start="2">
<li>默认创建好的 rook-ceph 块存储为离线状态，需要关联平台的私有云宿主机，宿主机会探测 ceph 集群的连通性，并且获取对应的 pool 容量信息：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/en/assets/images/attach-storage-host-e6fb10e6755e1f9ef19046834338de65.png" width="2264" height="1045" class="img_ev3q"></p>
<ol start="3">
<li>rook-ceph 块存储关联好宿主机后，状态就会变为“在线”，并且获取到了 20T 的容量：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/en/assets/images/rook-ceph-status-69a1e71545f0eef5414feb3ba6861e29.png" width="2280" height="834" class="img_ev3q"></p>
<ol start="4">
<li>创建虚拟机使用 <code>rook-ceph</code> 存储，这里主要是在虚拟机创建页面添加磁盘，选择存储类型为 <strong>Ceph RBD</strong>：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/en/assets/images/vm-with-ceph-ec90c2558b448214e4de3b07c941cb74.png" width="2251" height="799" class="img_ev3q"></p>
<ol start="5">
<li>等待虚拟机创建完成，通过 vnc 或者 ssh 登录虚拟机：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/en/assets/images/vm-running-2f5b9b9830c49e367f73421674747c96.png" width="1580" height="538" class="img_ev3q"></p>
<p>可以发现虚拟机里面挂载了 /dev/sda(系统盘) 和 /dev/sdb(数据盘)，底层都为 ceph 的 RBD 块设备，因为 ceph 底层块设备用的机械盘，用 dd 简单测试速度在 99 MB/s ，符合预期。</p>
<ol start="6">
<li>然后使用平台的 climc 命令查看虚拟机所在的宿主机，发现虚拟机 ceph-test-vm 运行在 node-1 计算节点上，同时改节点也是 Ceph 集群的存储节点，实现了超融合的架构：</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ climc server-list </span><span class="token parameter variable" style="color:#36acaa">--details</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--search</span><span class="token plain"> ceph-test-vm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+--------------+--------+---------------+--------+---------+------------+-----------+------------+---------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                  ID                  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     Name     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  Host  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">     IPs       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  Disk  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Status  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> vcpu_count </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> vmem_size </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Hypervisor </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> os_type </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+--------------+--------+---------------+--------+---------+------------+-----------+------------+---------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ffd8ec7c-1e2d-4427-89e0-81b6ce184185 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ceph-test-vm </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> node-1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.16</span><span class="token plain">.254.252</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">235520</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> running </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain">      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kvm        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Linux   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+--------------+--------+---------------+--------+---------+------------+-----------+------------+---------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="其它操作">其它操作<a class="hash-link" aria-label="Direct link to 其它操作" title="Direct link to 其它操作" href="/en/blog/rook-ceph-with-cloudpods#其它操作">​</a></h2>
<ul>
<li>删除 Rook 部署的 Ceph 集群请参考：<a href="https://rook.io/docs/rook/v1.7/ceph-teardown.html" target="_blank" rel="noopener noreferrer">Cleaning up a Cluster</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-pacific-v16-ceph">使用 Pacific (v16) Ceph<a class="hash-link" aria-label="Direct link to 使用 Pacific (v16) Ceph" title="Direct link to 使用 Pacific (v16) Ceph" href="/en/blog/rook-ceph-with-cloudpods#使用-pacific-v16-ceph">​</a></h2>
<p>上文介绍的流程适合部署 v14 版本的ceph，为了部署 v16 版本的ceph，首先需要把待部署的 ceph 镜像改为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry.cn-beijing.aliyuncs.com/yunionio/ceph:v16.2.14</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>另外，每个计算节点默认部署的是CentOS 7自带的ceph-common，版本为 v10.2.5。该版本的 ceph-common 已经无法访问 v16 ceph。为此，还需要升级每个计算节点的 ceph-common 版本。具体方法如下：</p>
<p>配置 ceph rpm repo 文件 /etc/yum.repos.d/ceph.repo, 内容为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ceph]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Ceph packages for $basearch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=https://download.ceph.com/rpm-15.2.17/el7/$basearch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=https://download.ceph.com/keys/release.asc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ceph-noarch]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Ceph noarch packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=https://download.ceph.com/rpm-15.2.17/el7/noarch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=https://download.ceph.com/keys/release.asc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ceph-source]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Ceph source packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=https://download.ceph.com/rpm-15.2.17/el7/SRPMS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=https://download.ceph.com/keys/release.asc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>保存 ceph.repo 后，执行如下命令安装 v15.2.17 的 ceph-common:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> ceph-common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注：因为ceph官方rpm未提供v16的CentOS 7 rpms，因此安装v15的rpms，该版本兼容v16的ceph-common。</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/yunionio/website/tree/master/blog/2021-10-09-rook-ceph-with-cloudpods/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/blog/skycomputing"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">天空计算——云计算的下一个时代?</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/blog/calico-customized-node-firewall"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">用Calico网络策略设置主机node防火墙规则</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#背景介绍">背景介绍</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#环境准备">环境准备</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#使用-rook-部署-ceph">使用 Rook 部署 Ceph</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#节点信息">节点信息</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#部署-rook-组件">部署 Rook 组件</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#创建-ceph-集群">创建 ceph 集群</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#cloudpods-虚拟机使用-rook-部署的-ceph">Cloudpods 虚拟机使用 Rook 部署的 Ceph</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#其它操作">其它操作</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/blog/rook-ceph-with-cloudpods#使用-pacific-v16-ceph">使用 Pacific (v16) Ceph</a></li></ul></div></div></div></div></div></div>
</body>
</html>